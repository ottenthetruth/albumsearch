<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="searchforalbums.css">
    <link rel="stylesheet" href="general.css">
    <title>Search for Albums!</title>
</head>

<body>
  <div class="myheader">
      <div class="banner">
          <h1 id="bannerText">YOUR WEBSITE BANNER</h1>
          <div class="nav-container">
              <a class="imherebutton">Search for Albums!</a>
              <a href="page2.html" class="page-button">My Profile</a>
              <a href="page3.html" class="page-button">Featured</a>
              <a href="page4.html" class="page-button">Page 4</a>
              <a href="page5.html" class="page-button">About RYM</a>
          </div>
      </div>
  </div>

<div class="parent">
    <div class="div1">
      <div class="search-bar">
            <input type="text" id="mysearch" class="search-input"  placeholder="Album">
            <input type="text" id="mysearchartist" class="search-input"  placeholder="Artist">
            <a onclick="getAlbums()" class="search-button">Search!</a>
      </div>
    </div>
</div>

<div class="parent2">
  <div class="album-cards-container">
  </div>
</div>


    <div id="album-results" class="album-results-container"></div>
    <div class="album-info">
    <h2 id="album-name"></h2>
    <p id="artist-name"></p>
    <img id="album-cover" src="" alt="Album Cover">
    </div>


<script>
    async function getAccessToken() {
        const urlParams = new URLSearchParams(window.location.search);
          const code = urlParams.get("code");
        if (code) {
            const tokenEndpoint = "https://accounts.spotify.com/api/token";
            const client_secret = "2d5a82decbc240e4adadcbd86f342321"; // Replace with your actual client secret
            const redirect_uri = "https://ottenthetruth.github.io/albumsearch/searchforalbums.html"; // Make sure this matches your Spotify App's redirect URI
            const basicAuthHeader = btoa(`e9fec6e1cb5241e0a41ab98db146bc3c:${client_secret}`);

            const data = {
                grant_type: "authorization_code",
                code: code,
                redirect_uri: redirect_uri,
            };

            const response = await fetch(tokenEndpoint, {
                method: "POST",
                headers: {
                    "Authorization": `Basic ${basicAuthHeader}`,
                    "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8",
                },
                body: new URLSearchParams(data),
            });

            if (response.status === 200) {
                const tokenData = await response.json();
                const accessToken = tokenData.access_token;

                localStorage.setItem("access_token", accessToken);

                return tokenData.access_token;
            } else {
              return localStorage.getItem("access_token");
            }
        }/* end if(code) */

    } /* end getAccessToken */

    async function getAlbums() {
        const accessToken = await getAccessToken();

        if (accessToken) {
            const searchQuery = document.getElementById("mysearch").value;
            const searchQueryArtist = document.getElementById("mysearchartist").value;
            if(searchQueryArtist != null) {
            const response = await fetch(`https://api.spotify.com/v1/search?q=remaster%2520album%3A${searchQuery}%2520artist%3A${searchQueryArtist}&type=album&limit=5`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                },
            });
          } else {
            const response = await fetch(`https://api.spotify.com/v1/search?q=remaster%2520album%3A${searchQuery}&type=album&limit=5`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                },
            });
          }
    if (response.status === 200) {
              /* Enter Code here */
              const data = await response.json();
              const albumResults = data.albums.items;

              const albumCardsContainer = document.querySelector('.album-cards-container');
              // Clear previous results
              albumCardsContainer.innerHTML = '';

              // Loop through the album results and create individual cards
              albumResults.forEach((album) => {
                if(album.artists[0].name === document.getElementById("mysearchartist").value) {
              const albumCard = document.createElement('div');
              albumCard.classList.add('album-card');

              const albumName = document.createElement('h2');
              albumName.textContent = album.name;

              const artistName = document.createElement('p');
              artistName.textContent = album.artists[0].name;

              const albumCover = document.createElement('img');
              albumCover.src = album.images[0].url;
              albumCover.alt = 'Album Cover';

              albumCard.appendChild(albumName);
              albumCard.appendChild(artistName);
              albumCard.appendChild(albumCover);

              albumCardsContainer.appendChild(albumCard);
                }//end if match
              });
            } /* end if response status */
        }
    }
</script>

</body>
</html>
